<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Reporte de Conducta</title>
  <link rel="stylesheet" href="reporte.css">
</head>
<body>
  <div class="contenedor">
    <h2>üìã Reporte de Conducta Individual</h2>
    <form id="form-reporte">
      <label>Nombre del alumno:</label>
      <input type="text" id="nombre_alumno" readonly><br>
    
      <label>Matr√≠cula del alumno:</label>
      <input type="text" id="matricula_alumno" readonly><br>
    
      <label>Grado:</label>
      <select id="grado" required>
        <option value="">Grado</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
      </select><br>
    
      <label>Grupo:</label>
      <select id="grupo" required>
        <option value="">Grupo</option>
        <option>A</option>
        <option>B</option>
        <option>C</option>
      </select><br>
    
      <label>Clase:</label>
      <select id="clase" required>
        <option value="">Selecciona</option>
        <option>Espa√±ol</option>
        <option>Lectura</option>
        <option>Ingl√©s</option>
        <option>Matem√°ticas</option>
        <option>Ciencias</option>
        <option>Geograf√≠a</option>
        <option>Historia</option>
        <option>F. C y E</option>
        <option>Educaci√≥n f√≠sica</option>
        <option>Vida saludable</option>
        <option>Artes</option>
        <option>Tutor√≠a</option>
        <option>Taller</option>
        <option>Otro</option>
      </select><br>
    
      <label>Hora:</label>
      <select id="hora" required>
        <option value="">Selecciona</option>
        <option>1a</option><option>2a</option><option>3a</option><option>4a</option>
        <option>5a</option><option>6a</option><option>7a</option><option>8a</option>
        <option>9a</option><option>1er descanso</option><option>2o descanso</option>
      </select><br>
    
      <label>Descripci√≥n de la conducta:</label><br>
      <textarea id="contenido" rows="5" required></textarea><br>
    
      <input type="submit" value="Enviar Reporte">
    </form>
    <div id="mensaje"></div>
    <script>
      const alumno = JSON.parse(localStorage.getItem("alumnoSeleccionado") || "{}");
      const docente = JSON.parse(localStorage.getItem("usuarioActual") || "{}");
    
      document.getElementById("nombre_alumno").value = alumno.nombre || "";
      document.getElementById("matricula_alumno").value = alumno.usuario || "";
      document.getElementById("grado").value = alumno.grado || "";
      document.getElementById("grupo").value = alumno.grupo || "";
    
      document.getElementById("form-reporte").addEventListener("submit", async e => {
        e.preventDefault();
    
        const data = {
          matricula_alumno: document.getElementById("matricula_alumno").value,
          matricula_docente: docente.usuario, // aseg√∫rate que est√© en localStorage
          fecha: new Date().toLocaleDateString("es-MX"),
          clase: document.getElementById("clase").value,
          hora: document.getElementById("hora").value,
          contenido: document.getElementById("contenido").value
        };
    
        const res = await fetch("https://pagina-oficial-amhj.onrender.com/api/reportes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });
    
        const result = await res.json();
        document.getElementById("mensaje").textContent = result.mensaje || "Reporte enviado con √©xito.";
        document.getElementById("form-reporte").reset();
      });
    </script>
    
</body>
</html>